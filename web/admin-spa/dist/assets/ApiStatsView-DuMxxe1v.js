import{aP as vt,r as L,c as j,aX as st,x as i,y as r,z as t,O as h,L as K,P as l,u as e,C as A,K as nt,aq as dt,aa as mt,f as gt,Y as ft,Q as X,ac as et,B as lt,R as Q,o as yt,V as pt,I as ot,a5 as bt,q as kt,aW as ht,J as xt,av as _t}from"./vue-vendor-R8HMg95E.js";import{_ as at,A as wt,a as $t}from"./index-Cf1lGg_N.js";import{L as St}from"./LogoTitle-CLcl5fTx.js";import{T as Ct}from"./ThemeToggle-Bnm-h_kO.js";import{b as Kt}from"./vendor-Dr8jvgFu.js";import{_ as Tt}from"./WindowCountdown-DF7xS2EZ.js";import At from"./TutorialView-C5IOGrS6.js";import"./element-plus-BUfCkBQO.js";class Pt{constructor(){this.baseURL=window.location.origin,this.isDev=!1}async request(b,s={}){try{this.isDev&&b.startsWith("/admin")&&(b="/webapi"+b);const v=await fetch(`${this.baseURL}${b}`,{headers:{"Content-Type":"application/json",...s.headers},...s}),d=await v.json();if(!v.ok)throw new Error(d.message||`请求失败: ${v.status}`);return d}catch(v){throw console.error("API Stats request error:",v),v}}async getKeyId(b){return this.request("/apiStats/api/get-key-id",{method:"POST",body:JSON.stringify({apiKey:b})})}async getUserStats(b){return this.request("/apiStats/api/user-stats",{method:"POST",body:JSON.stringify({apiId:b})})}async getUserModelStats(b,s="daily"){return this.request("/apiStats/api/user-model-stats",{method:"POST",body:JSON.stringify({apiId:b,period:s})})}async getOemSettings(){try{return await this.request("/admin/oem-settings")}catch(b){return console.error("Failed to load OEM settings:",b),{success:!0,data:{siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}}}async getBatchStats(b){return this.request("/apiStats/api/batch-stats",{method:"POST",body:JSON.stringify({apiIds:b})})}async getBatchModelStats(b,s="daily"){return this.request("/apiStats/api/batch-model-stats",{method:"POST",body:JSON.stringify({apiIds:b,period:s})})}}const G=new Pt,rt=vt("apistats",()=>{const O=L(""),b=L(null),s=L(!1),v=L(!1),d=L(!0),x=L(""),g=L("daily"),p=L(null),$=L([]),P=L(null),y=L(null),T=L({siteName:"",siteIcon:"",siteIconData:""}),E=L(!1),S=L([]),w=L([]),u=L(null),n=L([]),M=L([]),F=j(()=>{const c={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return E.value&&u.value?g.value==="daily"?u.value.dailyUsage||c:u.value.monthlyUsage||c:g.value==="daily"?P.value||c:y.value||c}),Y=j(()=>{if(!p.value||!F.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const c=F.value,_=p.value.limits;return{tokenUsage:_.tokenLimit>0?Math.min(c.allTokens/_.tokenLimit*100,100):0,costUsage:_.dailyCostLimit>0?Math.min(c.cost/_.dailyCostLimit*100,100):0,requestUsage:_.rateLimitRequests>0?Math.min(c.requests/_.rateLimitRequests*100,100):0}});async function V(){if(E.value)return U();const c=O.value.trim();if(!c){x.value="请输入 API Key";return}if(c.length<10||c.length>512){x.value="API Key 格式无效：长度应在 10-512 个字符之间";return}s.value=!0,x.value="",p.value=null,$.value=[],b.value=null;try{const _=await G.getKeyId(c);if(_.success){b.value=_.data.id;const I=await G.getUserStats(b.value);if(I.success)p.value=I.data,await B(),x.value="",z();else throw new Error(I.message||"查询失败")}else throw new Error(_.message||"获取 API Key ID 失败")}catch(_){console.error("Query stats error:",_),x.value=_.message||"查询统计数据失败，请检查您的 API Key 是否正确",p.value=null,$.value=[],b.value=null}finally{s.value=!1}}async function B(){b.value&&(await Promise.all([R("daily"),R("monthly")]),await D(g.value))}async function R(c){try{const _=await G.getUserModelStats(b.value,c);if(_.success){const I=_.data||[],W={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};I.forEach(q=>{var J;W.requests+=q.requests||0,W.inputTokens+=q.inputTokens||0,W.outputTokens+=q.outputTokens||0,W.cacheCreateTokens+=q.cacheCreateTokens||0,W.cacheReadTokens+=q.cacheReadTokens||0,W.allTokens+=q.allTokens||0,W.cost+=((J=q.costs)==null?void 0:J.total)||0}),W.formattedCost=Z(W.cost),c==="daily"?P.value=W:y.value=W}else console.warn(`Failed to load ${c} stats:`,_.message)}catch(_){console.error(`Load ${c} stats error:`,_)}}async function D(c="daily"){if(b.value){v.value=!0;try{const _=await G.getUserModelStats(b.value,c);if(_.success)$.value=_.data||[];else throw new Error(_.message||"加载模型统计失败")}catch(_){console.error("Load model stats error:",_),$.value=[]}finally{v.value=!1}}}async function k(c){if(!(g.value===c||v.value)){if(g.value=c,E.value&&w.value.length>0){await f(c);return}(c==="daily"&&!P.value||c==="monthly"&&!y.value)&&await R(c),await D(c)}}async function H(){var c,_;if(b.value){s.value=!0,x.value="",p.value=null,$.value=[];try{const I=await G.getUserStats(b.value);if(I.success)p.value=I.data,console.log("API Stats - Full response:",I.data),console.log("API Stats - limits data:",I.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(c=I.data.limits)==null?void 0:c.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(_=I.data.limits)==null?void 0:_.weeklyOpusCost),await B(),x.value="";else throw new Error(I.message||"查询失败")}catch(I){console.error("Load stats with apiId error:",I),x.value=I.message||"查询统计数据失败",p.value=null,$.value=[]}finally{s.value=!1}}}async function tt(){d.value=!0;try{const c=await G.getOemSettings();c&&c.success&&c.data&&(T.value={...T.value,...c.data})}catch(c){console.error("Error loading OEM settings:",c),T.value={siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}finally{d.value=!1}}function Z(c){return typeof c!="number"||c===0?"$0.000000":c>=1?"$"+c.toFixed(2):c>=.01?"$"+c.toFixed(4):"$"+c.toFixed(6)}function z(){if(b.value){const c=new URL(window.location);c.searchParams.set("apiId",b.value),window.history.pushState({},"",c)}}async function U(){const c=o();if(c.length===0){x.value="请输入至少一个有效的 API Key";return}s.value=!0,x.value="",u.value=null,n.value=[],M.value=[],$.value=[],S.value=c,w.value=[];try{const _=await Promise.allSettled(c.map(J=>G.getKeyId(J))),I=[],W=[];if(_.forEach((J,it)=>{J.status==="fulfilled"&&J.value.success?(I.push(J.value.data.id),W.push(c[it])):M.value.push(c[it])}),I.length===0)throw new Error("所有 API Key 都无效");w.value=I,S.value=W;const q=await G.getBatchStats(I);if(q.success)u.value=q.data.aggregated,n.value=q.data.individual,p.value=q.data.aggregated,P.value=q.data.aggregated.dailyUsage||null,y.value=q.data.aggregated.monthlyUsage||null,await f(g.value),a();else throw new Error(q.message||"批量查询失败")}catch(_){console.error("Batch query error:",_),x.value=_.message||"批量查询统计数据失败",u.value=null,n.value=[]}finally{s.value=!1}}async function f(c="daily"){if(w.value.length!==0){v.value=!0;try{const _=await G.getBatchModelStats(w.value,c);if(_.success)$.value=_.data||[];else throw new Error(_.message||"加载批量模型统计失败")}catch(_){console.error("Load batch model stats error:",_),$.value=[]}finally{v.value=!1}}}function o(){if(!O.value)return[];const c=O.value.split(/[,\n]+/).map(I=>I.trim()).filter(I=>I.length>=10&&I.length<=512);return[...new Set(c)].slice(0,30)}function a(){if(w.value.length>0){const c=new URL(window.location);c.searchParams.set("apiIds",w.value.join(",")),c.searchParams.set("batch","true"),window.history.pushState({},"",c)}}function m(){O.value=""}function C(){p.value=null,$.value=[],P.value=null,y.value=null,x.value="",g.value="daily",b.value=null,S.value=[],w.value=[],u.value=null,n.value=[],M.value=[]}function N(){O.value="",E.value=!1,C()}return{apiKey:O,apiId:b,loading:s,modelStatsLoading:v,oemLoading:d,error:x,statsPeriod:g,statsData:p,modelStats:$,dailyStats:P,monthlyStats:y,oemSettings:T,multiKeyMode:E,apiKeys:S,apiIds:w,aggregatedStats:u,individualStats:n,invalidKeys:M,currentPeriodData:F,usagePercentages:Y,queryStats:V,queryBatchStats:U,loadAllPeriodStats:B,loadPeriodStats:R,loadModelStats:D,loadBatchModelStats:f,switchPeriod:k,loadStatsWithApiId:H,loadOemSettings:tt,clearData:C,clearInput:m,reset:N}}),Lt={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},It={class:"mx-auto max-w-4xl"},Mt={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},Dt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},qt={class:"button-group flex items-center gap-2"},jt={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},Ut={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},Rt={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},Nt={class:"lg:col-span-3"},Ot=["disabled"],Et={key:1,class:"relative"},Ft=["disabled"],Wt={class:"lg:col-span-1"},Bt=["disabled"],Vt={key:0,class:"fas fa-spinner loading-spinner"},zt={key:1,class:"fas fa-search"},Jt={class:"security-notice mt-4"},Yt={key:0,class:"mt-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},Ht={__name:"ApiKeyInput",setup(O){const b=rt(),{apiKey:s,loading:v,multiKeyMode:d}=st(b),{queryStats:x,clearInput:g}=b,p=j(()=>{if(!d.value||!s.value)return[];const P=s.value.split(/[,\n]+/).map(T=>T.trim()).filter(T=>T.length>0);return[...new Set(P)].slice(0,30)}),$=j(()=>d.value?p.value.length>0:s.value&&s.value.trim().length>0);return(P,y)=>(r(),i("div",Lt,[y[15]||(y[15]=t("div",{class:"wide-card-title mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-chart-line mr-3"}),h(" 使用统计查询 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),t("div",It,[t("div",Mt,[t("label",Dt,[y[8]||(y[8]=t("i",{class:"fas fa-key mr-2"},null,-1)),h(" "+l(e(d)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),t("div",qt,[t("div",jt,[t("button",{class:A(["mode-switch-btn",{active:!e(d)}]),title:"单一模式",onClick:y[0]||(y[0]=T=>d.value=!1)},y[9]||(y[9]=[t("i",{class:"fas fa-key"},null,-1),t("span",{class:"ml-2 hidden sm:inline"},"单一",-1)]),2),t("button",{class:A(["mode-switch-btn",{active:e(d)}]),title:"聚合模式",onClick:y[1]||(y[1]=T=>d.value=!0)},[y[10]||(y[10]=t("i",{class:"fas fa-layer-group"},null,-1)),y[11]||(y[11]=t("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),e(d)&&p.value.length>0?(r(),i("span",Ut,l(p.value.length),1)):K("",!0)],2)])])]),t("div",Rt,[t("div",Nt,[e(d)?(r(),i("div",Et,[nt(t("textarea",{"onUpdate:modelValue":y[4]||(y[4]=T=>gt(s)?s.value=T:null),class:"wide-card-input w-full resize-y",disabled:e(v),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:y[5]||(y[5]=mt(ft((...T)=>e(x)&&e(x)(...T),["ctrl"]),["enter"]))},null,40,Ft),[[dt,e(s)]]),e(s)&&!e(v)?(r(),i("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:y[6]||(y[6]=(...T)=>e(g)&&e(g)(...T))},y[12]||(y[12]=[t("i",{class:"fas fa-times-circle"},null,-1)]))):K("",!0)])):nt((r(),i("input",{key:0,"onUpdate:modelValue":y[2]||(y[2]=T=>gt(s)?s.value=T:null),class:"wide-card-input w-full",disabled:e(v),placeholder:"请输入您的 API Key (cr_...)",type:"password",onKeyup:y[3]||(y[3]=mt((...T)=>e(x)&&e(x)(...T),["enter"]))},null,40,Ot)),[[dt,e(s)]])]),t("div",Wt,[t("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:e(v)||!$.value,onClick:y[7]||(y[7]=(...T)=>e(x)&&e(x)(...T))},[e(v)?(r(),i("i",Vt)):(r(),i("i",zt)),h(" "+l(e(v)?"查询中...":"查询统计"),1)],8,Bt)])]),t("div",Jt,[y[13]||(y[13]=t("i",{class:"fas fa-shield-alt mr-2"},null,-1)),h(" "+l(e(d)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),e(d)?(r(),i("div",Yt,y[14]||(y[14]=[t("i",{class:"fas fa-lightbulb mr-2"},null,-1),t("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)]))):K("",!0)])]))}},Gt=at(Ht,[["__scopeId","data-v-11e74200"]]),Qt={class:"space-y-6 md:space-y-8"},Xt={class:"grid grid-cols-1 items-stretch gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},Zt={class:"card-section"},te={class:"section-header"},ee={class:"header-title"},se={key:0,class:"info-grid"},ae={class:"info-item"},re={class:"info-value"},le={class:"info-item"},ie={class:"info-value text-green-600 dark:text-emerald-400"},oe={key:0,class:"info-item"},ne={class:"info-value text-red-500 dark:text-red-400"},de={class:"info-item"},ue={class:"info-value"},ce={class:"info-item"},me={class:"info-value"},ge={class:"info-item"},xe={class:"info-value text-indigo-600 dark:text-indigo-300"},fe={key:1,class:"info-item xl:col-span-2"},ye={class:"space-y-2"},pe={class:"truncate"},ve={class:"font-semibold"},be={key:1,class:"info-grid"},ke={class:"info-item"},he={class:"info-value break-all"},_e={class:"info-item"},we={class:"info-item"},$e={class:"info-value"},Se={class:"info-item"},Ce={class:"info-value break-all"},Ke={class:"info-item xl:col-span-2"},Te={class:"info-value"},Ae={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},Pe={key:0,class:"text-red-500 dark:text-red-400"},Le={key:1,class:"text-orange-500 dark:text-orange-400"},Ie={key:2},Me={key:2,class:"text-gray-400 dark:text-gray-500"},De={class:"card-section"},qe={class:"section-header"},je={class:"header-tag"},Ue={class:"metric-grid"},Re={class:"metric-card"},Ne={class:"metric-value text-green-600 dark:text-emerald-300"},Oe={class:"metric-label"},Ee={class:"metric-card"},Fe={class:"metric-value text-blue-600 dark:text-sky-300"},We={class:"metric-label"},Be={class:"metric-card"},Ve={class:"metric-value text-purple-600 dark:text-violet-300"},ze={class:"metric-label"},Je={class:"metric-card"},Ye={class:"metric-value text-amber-500 dark:text-amber-300"},He={class:"metric-label"},Ge={key:0,class:"card-section"},Qe={class:"flex items-center justify-between gap-3"},Xe={class:"flex items-center gap-3"},Ze={class:"account-name"},ts={class:"account-sub"},es={key:0,class:"mt-3 space-y-2"},ss={class:"progress-row"},as={class:"progress-track"},rs={class:"progress-value"},ls={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},is={key:0,class:"font-medium text-indigo-600 dark:text-indigo-400"},os={key:1,class:"mt-3"},ns={key:0,class:"space-y-2"},ds={class:"quota-header"},us={class:"quota-percent"},cs={class:"progress-track"},ms={class:"quota-foot"},gs={key:1,class:"rounded-xl bg-slate-100 px-3 py-2 text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-300"},xs={__name:"StatsOverview",setup(O){const b=rt(),{statsData:s,statsPeriod:v,currentPeriodData:d,multiKeyMode:x,aggregatedStats:g,individualStats:p,invalidKeys:$}=st(b),P=j(()=>!p.value||p.value.length===0?[]:[...p.value].sort((o,a)=>{var m,C;return(((m=a.usage)==null?void 0:m.allTokens)||0)-(((C=o.usage)==null?void 0:C.allTokens)||0)}).slice(0,3)),y=o=>{var m;return!g.value||!g.value.usage.allTokens?0:((((m=o.usage)==null?void 0:m.allTokens)||0)/g.value.usage.allTokens*100).toFixed(1)},T=o=>{if(!o)return"无";try{return Kt(o).format("YYYY年MM月DD日 HH:mm")}catch{return"格式错误"}},E=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",S=o=>o?new Date(o)<new Date:!1,w=o=>{if(!o)return!1;const C=(new Date(o)-new Date)/(1e3*60*60*24);return C>0&&C<=7},u=o=>(typeof o!="number"&&(o=parseInt(o)||0),o===0?"0":o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toLocaleString()),n=o=>({claude:"Claude",gemini:"Gemini",all:"全部模型"})[o]||o||"未知",M=j(()=>{var m,C;const o=(C=(m=s.value)==null?void 0:m.accounts)==null?void 0:C.details;if(!o)return[];const a=[];return o.claude&&o.claude.accountType==="dedicated"&&a.push({key:"claude",...o.claude}),o.openai&&o.openai.accountType==="dedicated"&&a.push({key:"openai",...o.openai}),a}),F=j(()=>{const o=M.value.length;return o<=1?"md:grid-cols-1 lg:grid-cols-1":o===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),Y=o=>o?o.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",V=o=>{if(!o||o<=0)return"";const a=Math.floor(o),m=Math.floor(a/1440),C=Math.floor(a%1440/60),N=a%60;return m>0?C>0?`${m}天${C}小时`:`${m}天`:C>0?N>0?`${C}小时${N}分钟`:`${C}小时`:`${N}分钟`},B=o=>{if(!o)return{text:"状态未知",class:"text-gray-400"};if(o.isRateLimited){const a=V(o.minutesRemaining);return{text:`限流中${a?` · 剩余约 ${a}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},R=(o,a)=>{if(!o||!a)return"暂无时间窗口信息";const m=new Date(o),C=new Date(a),N=c=>`${`${c.getHours()}`.padStart(2,"0")}:${`${c.getMinutes()}`.padStart(2,"0")}`;return`${N(m)} - ${N(C)}`},D=o=>{if(!o||o<=0)return"";const a=Math.floor(o/60),m=o%60;return a>0?`${a}小时${m}分钟`:`${m}分钟`},k=(o,a)=>{var C;if(!o)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((C=a==null?void 0:a.rateLimitStatus)!=null&&C.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const m=String(o).toLowerCase();return m==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":m==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},H=o=>{if(!o)return null;const a=typeof o.usedPercent=="number"&&!Number.isNaN(o.usedPercent)?o.usedPercent:null,m=typeof o.resetAfterSeconds=="number"&&!Number.isNaN(o.resetAfterSeconds)?o.resetAfterSeconds:null,C=typeof o.remainingSeconds=="number"?o.remainingSeconds:null,N=o.resetAt?Date.parse(o.resetAt):null;return m!==null&&(C!==null&&C<=0||N!==null&&!Number.isNaN(N)&&Date.now()>=N)?0:a===null?null:Math.max(0,Math.min(100,a))},tt=o=>{const a=H(o);return a===null?"bg-gradient-to-r from-gray-300 to-gray-400":a>=90?"bg-gradient-to-r from-red-500 to-red-600":a>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},Z=o=>{const a=H(o);return a===null?"0%":`${a}%`},z=o=>{const a=H(o);return a===null?"--":`${a.toFixed(1)}%`},U=o=>{if(!o)return"--";let a=o.remainingSeconds;if(a==null&&(a=o.resetAfterSeconds),a==null||Number.isNaN(Number(a)))return"--";a=Math.max(0,Math.floor(Number(a)));const m=Math.floor(a/86400),C=Math.floor(a%86400/3600),N=Math.floor(a%3600/60),c=a%60;return m>0?C>0?`${m}天${C}小时`:`${m}天`:C>0?N>0?`${C}小时${N}分钟`:`${C}小时`:N>0?`${N}分钟`:`${c}秒`},f=o=>o==="secondary"?"周限":"5h";return(o,a)=>(r(),i("div",Qt,[t("div",Xt,[t("div",Zt,[t("header",te,[t("i",{class:A(["header-icon",e(x)?"fas fa-layer-group text-purple-500":"fas fa-info-circle text-blue-500"])},null,2),t("h3",ee,l(e(x)?"批量查询概要":"API Key 信息"),1)]),e(x)&&e(g)?(r(),i("div",se,[t("div",ae,[a[0]||(a[0]=t("p",{class:"info-label"},"查询 Keys 数",-1)),t("p",re,l(e(g).totalKeys)+" 个",1)]),t("div",le,[a[2]||(a[2]=t("p",{class:"info-label"},"有效 Keys 数",-1)),t("p",ie,[a[1]||(a[1]=t("i",{class:"fas fa-check-circle mr-1"},null,-1)),h(l(e(g).activeKeys)+" 个 ",1)])]),e($).length>0?(r(),i("div",oe,[a[4]||(a[4]=t("p",{class:"info-label"},"无效 Keys 数",-1)),t("p",ne,[a[3]||(a[3]=t("i",{class:"fas fa-times-circle mr-1"},null,-1)),h(l(e($).length)+" 个 ",1)])])):K("",!0),t("div",de,[a[5]||(a[5]=t("p",{class:"info-label"},"总请求数",-1)),t("p",ue,l(u(e(g).usage.requests)),1)]),t("div",ce,[a[6]||(a[6]=t("p",{class:"info-label"},"总 Token 数",-1)),t("p",me,l(u(e(g).usage.allTokens)),1)]),t("div",ge,[a[7]||(a[7]=t("p",{class:"info-label"},"总费用",-1)),t("p",xe,l(e(g).usage.formattedCost),1)]),e(p).length>1?(r(),i("div",fe,[a[8]||(a[8]=t("p",{class:"info-label"},"Top 3 贡献占比",-1)),t("div",ye,[(r(!0),i(X,null,et(P.value,m=>(r(),i("div",{key:m.apiId,class:"contributor-item"},[t("span",pe,l(m.name),1),t("span",ve,l(y(m))+"%",1)]))),128))])])):K("",!0)])):(r(),i("div",be,[t("div",ke,[a[9]||(a[9]=t("p",{class:"info-label"},"名称",-1)),t("p",he,l(e(s).name),1)]),t("div",_e,[a[10]||(a[10]=t("p",{class:"info-label"},"状态",-1)),t("p",{class:A(["info-value font-semibold",e(s).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[t("i",{class:A(["mr-1",e(s).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),h(" "+l(e(s).isActive?"活跃":"已停用"),1)],2)]),t("div",we,[a[11]||(a[11]=t("p",{class:"info-label"},"权限",-1)),t("p",$e,l(n(e(s).permissions)),1)]),t("div",Se,[a[12]||(a[12]=t("p",{class:"info-label"},"创建时间",-1)),t("p",Ce,l(T(e(s).createdAt)),1)]),t("div",Ke,[a[17]||(a[17]=t("p",{class:"info-label"},"过期时间",-1)),t("div",Te,[e(s).expirationMode==="activation"&&!e(s).isActivated?(r(),i(X,{key:0},[a[13]||(a[13]=t("span",{class:"text-amber-600 dark:text-amber-400"},[t("i",{class:"fas fa-pause-circle mr-1"}),h("未激活 ")],-1)),t("span",Ae," 首次使用后 "+l(e(s).activationDays||(e(s).activationUnit==="hours"?24:30))+" "+l(e(s).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):e(s).expiresAt?(r(),i(X,{key:1},[S(e(s).expiresAt)?(r(),i("span",Pe,a[14]||(a[14]=[t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),h("已过期 ",-1)]))):w(e(s).expiresAt)?(r(),i("span",Le,[a[15]||(a[15]=t("i",{class:"fas fa-clock mr-1"},null,-1)),h(l(E(e(s).expiresAt)),1)])):(r(),i("span",Ie,l(E(e(s).expiresAt)),1))],64)):(r(),i("span",Me,a[16]||(a[16]=[t("i",{class:"fas fa-infinity mr-1"},null,-1),h("永不过期 ",-1)])))])])]))]),t("div",De,[t("header",qe,[a[18]||(a[18]=t("i",{class:"header-icon fas fa-chart-bar text-green-500"},null,-1)),a[19]||(a[19]=t("h3",{class:"header-title"},"使用统计概览",-1)),t("span",je,l(e(v)==="daily"?"今日":"本月"),1)]),t("div",Ue,[t("div",Re,[t("p",Ne,l(u(e(d).requests)),1),t("p",Oe,l(e(v)==="daily"?"今日":"本月")+"请求数",1)]),t("div",Ee,[t("p",Fe,l(u(e(d).allTokens)),1),t("p",We,l(e(v)==="daily"?"今日":"本月")+"Token 数",1)]),t("div",Be,[t("p",Ve,l(e(d).formattedCost||"$0.000000"),1),t("p",ze,l(e(v)==="daily"?"今日":"本月")+"费用",1)]),t("div",Je,[t("p",Ye,l(u(e(d).inputTokens)),1),t("p",He,l(e(v)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!e(x)&&M.value.length>0?(r(),i("div",Ge,[a[21]||(a[21]=t("header",{class:"section-header"},[t("i",{class:"header-icon fas fa-plug text-indigo-500"}),t("h3",{class:"header-title"},"专属账号运行状态"),t("span",{class:"header-tag"},"实时更新")],-1)),t("div",{class:A(["grid grid-cols-1 gap-4",F.value])},[(r(!0),i(X,null,et(M.value,m=>{var C,N,c,_,I,W;return r(),i("div",{key:m.id||m.key,class:"account-card"},[t("div",Qe,[t("div",Xe,[t("span",{class:A(["account-icon",m.platform==="claude"?"icon-claude":"icon-openai"])},[t("i",{class:A(m.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),t("div",null,[t("p",Ze,l(Y(m)),1),t("p",ts,l(m.platform==="claude"?"会话窗口":"额度窗口"),1)])]),B(m.rateLimitStatus)?(r(),i("div",{key:0,class:A(["rate-badge",B(m.rateLimitStatus).class])},[a[20]||(a[20]=t("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),h(" "+l(B(m.rateLimitStatus).text),1)],2)):K("",!0)]),m.platform==="claude"?(r(),i("div",es,[t("div",ss,[t("div",as,[t("div",{class:A(["progress-bar",k((C=m.sessionWindow)==null?void 0:C.sessionWindowStatus,m)]),style:lt({width:`${Math.min(100,Math.max(0,((N=m.sessionWindow)==null?void 0:N.progress)||0))}%`})},null,6)]),t("span",rs,l(Math.min(100,Math.max(0,Math.round(((c=m.sessionWindow)==null?void 0:c.progress)||0))))+"% ",1)]),t("div",ls,[t("span",null,l(R((_=m.sessionWindow)==null?void 0:_.windowStart,(I=m.sessionWindow)==null?void 0:I.windowEnd)),1),((W=m.sessionWindow)==null?void 0:W.remainingTime)>0?(r(),i("span",is," 剩余 "+l(D(m.sessionWindow.remainingTime)),1)):K("",!0)])])):m.platform==="openai"?(r(),i("div",os,[m.codexUsage?(r(),i("div",ns,[(r(),i(X,null,et(["primary","secondary"],q=>{var J,it,ut,ct;return t("div",{key:`${m.key}-${q}`,class:"quota-row"},[t("div",ds,[t("span",{class:A(["quota-tag",q==="primary"?"tag-indigo":"tag-blue"])},l(f(q)),3),t("span",us,l(z((J=m.codexUsage)==null?void 0:J[q])),1)]),t("div",cs,[t("div",{class:A(["progress-bar",tt((it=m.codexUsage)==null?void 0:it[q])]),style:lt({width:Z((ut=m.codexUsage)==null?void 0:ut[q])})},null,6)]),t("div",ms," 重置剩余 "+l(U((ct=m.codexUsage)==null?void 0:ct[q])),1)])}),64))])):(r(),i("p",gs," 暂无额度使用数据 "))])):K("",!0)])}),128))],2)])):K("",!0)]))}},fs=at(xs,[["__scopeId","data-v-b72df2cd"]]),ys={class:"card p-4 md:p-6"},ps={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},vs={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},bs={class:"space-y-2 md:space-y-3"},ks={class:"flex items-center justify-between"},hs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},_s={class:"flex items-center justify-between"},ws={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},$s={class:"flex items-center justify-between"},Ss={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Cs={class:"flex items-center justify-between"},Ks={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ts={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},As={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},Ps={class:"text-sm md:text-base"},Ls={class:"text-lg md:text-xl"},Is={__name:"TokenDistribution",setup(O){const b=rt(),{statsPeriod:s,currentPeriodData:v}=st(b),d=x=>(typeof x!="number"&&(x=parseInt(x)||0),x===0?"0":x>=1e6?(x/1e6).toFixed(1)+"M":x>=1e3?(x/1e3).toFixed(1)+"K":x.toLocaleString());return(x,g)=>(r(),i("div",ys,[t("h3",ps,[g[0]||(g[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),h(" Token 使用分布 ")],-1)),t("span",vs,"("+l(e(s)==="daily"?"今日":"本月")+")",1)]),t("div",bs,[t("div",ks,[g[1]||(g[1]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),h(" 输入 Token ")],-1)),t("span",hs,l(d(e(v).inputTokens)),1)]),t("div",_s,[g[2]||(g[2]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-left mr-1 text-xs text-blue-500 md:mr-2 md:text-sm"}),h(" 输出 Token ")],-1)),t("span",ws,l(d(e(v).outputTokens)),1)]),t("div",$s,[g[3]||(g[3]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-save mr-1 text-xs text-purple-500 md:mr-2 md:text-sm"}),h(" 缓存创建 Token ")],-1)),t("span",Ss,l(d(e(v).cacheCreateTokens)),1)]),t("div",Cs,[g[4]||(g[4]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),h(" 缓存读取 Token ")],-1)),t("span",Ks,l(d(e(v).cacheReadTokens)),1)])]),t("div",Ts,[t("div",As,[t("span",Ps,l(e(s)==="daily"?"今日":"本月")+"总计",1),t("span",Ls,l(d(e(v).allTokens)),1)])])]))}},Ms=at(Is,[["__scopeId","data-v-d9e5c1dd"]]),Ds={class:"flex h-full flex-col gap-4 md:gap-6"},qs={class:"card flex h-full flex-col p-4 md:p-6"},js={class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},Us={key:0,class:"space-y-4"},Rs={class:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Ns={class:"mb-3 flex items-center justify-between"},Os={class:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-800 dark:text-blue-200"},Es={class:"grid grid-cols-2 gap-3"},Fs={class:"text-center"},Ws={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},Bs={class:"text-center"},Vs={class:"text-lg font-bold text-green-600"},zs={class:"rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Js={class:"space-y-2"},Ys={class:"flex items-center justify-between"},Hs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Gs={class:"flex items-center justify-between"},Qs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Xs={class:"flex items-center justify-between"},Zs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ta={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},ea={class:"text-red-700 dark:text-red-300"},sa={key:1,class:"space-y-4 md:space-y-5"},aa={class:"mb-2 flex items-center justify-between"},ra={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},la={key:0},ia={key:1,class:"flex items-center gap-1"},oa={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},na={key:1,class:"h-2 w-full rounded-full bg-gray-200"},da={class:"mb-2 flex items-center justify-between"},ua={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ca={key:0},ma={key:1,class:"flex items-center gap-1"},ga={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},xa={key:1,class:"h-2 w-full rounded-full bg-gray-200"},fa={key:0},ya={class:"mb-2 flex items-center justify-between"},pa={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},va={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ba={key:1},ka={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},ha={key:0},_a={key:1},wa={key:2},$a={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},Sa={class:"flex items-center justify-between"},Ca={class:"text-sm font-medium text-gray-900 md:text-base"},Ka={key:0},Ta={key:1,class:"flex items-center gap-1"},Aa={class:"flex items-center justify-between"},Pa={class:"text-sm font-medium text-gray-900 md:text-base"},La={key:0,class:"text-orange-600"},Ia={key:1,class:"text-green-600"},Ma={class:"space-y-2"},Da={class:"flex items-center justify-between"},qa={class:"text-sm font-medium text-gray-900 md:text-base"},ja={key:0,class:"text-orange-600"},Ua={key:1,class:"text-green-600"},Ra={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-blue-50 p-2 dark:bg-blue-900/20 md:p-3"},Na={key:0,class:"card !overflow-visible p-4 md:p-6"},Oa={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},Ea={class:"max-h-64 space-y-1 overflow-y-auto pr-1 md:max-h-80 md:space-y-2"},Fa={class:"break-all text-gray-800 dark:text-gray-200"},Wa={__name:"LimitConfig",setup(O){const b=rt(),{statsData:s,multiKeyMode:v,aggregatedStats:d,invalidKeys:x}=st(b),g=j(()=>{var n;const u=(n=s.value)==null?void 0:n.restrictions;return u?u.enableModelRestriction===!0&&Array.isArray(u.restrictedModels)&&u.restrictedModels.length>0:!1}),p=j(()=>{var n;const u=(n=s.value)==null?void 0:n.restrictions;return u?u.enableClientRestriction===!0&&Array.isArray(u.allowedClients)&&u.allowedClients.length>0:!1}),$=()=>{if(!s.value.limits.dailyCostLimit||s.value.limits.dailyCostLimit===0)return 0;const u=s.value.limits.currentDailyCost/s.value.limits.dailyCostLimit*100;return Math.min(u,100)},P=()=>{const u=$();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-green-500"},y=()=>{if(!s.value.limits.totalCostLimit||s.value.limits.totalCostLimit===0)return 0;const u=s.value.limits.currentTotalCost/s.value.limits.totalCostLimit*100;return Math.min(u,100)},T=()=>{const u=y();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-blue-500"},E=()=>{if(!s.value.limits.weeklyOpusCostLimit||s.value.limits.weeklyOpusCostLimit===0)return 0;const u=s.value.limits.weeklyOpusCost/s.value.limits.weeklyOpusCostLimit*100;return Math.min(u,100)},S=()=>{const u=E();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-indigo-500"},w=u=>(typeof u!="number"&&(u=parseInt(u)||0),u===0?"0":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e3?(u/1e3).toFixed(1)+"K":u.toLocaleString());return(u,n)=>(r(),i("div",Ds,[t("div",qs,[t("h3",js,[n[0]||(n[0]=t("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),h(" "+l(e(v)?"限制配置（聚合查询模式）":"限制配置"),1)]),e(v)&&e(d)?(r(),i("div",Us,[t("div",Rs,[t("div",Ns,[n[1]||(n[1]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-layer-group mr-2 text-blue-500"}),h(" API Keys 概况 ")],-1)),t("span",Os,l(e(d).activeKeys)+"/"+l(e(d).totalKeys),1)]),t("div",Es,[t("div",Fs,[t("div",Ws,l(e(d).totalKeys),1),n[2]||(n[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),t("div",Bs,[t("div",Vs,l(e(d).activeKeys),1),n[3]||(n[3]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),t("div",zs,[n[7]||(n[7]=t("div",{class:"mb-3 flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),t("div",Js,[t("div",Ys,[n[4]||(n[4]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-database mr-1 text-gray-400"}),h(" 总请求数 ")],-1)),t("span",Hs,l(w(e(d).usage.requests)),1)]),t("div",Gs,[n[5]||(n[5]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-coins mr-1 text-yellow-500"}),h(" 总 Tokens ")],-1)),t("span",Qs,l(w(e(d).usage.allTokens)),1)]),t("div",Xs,[n[6]||(n[6]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),h(" 总费用 ")],-1)),t("span",Zs,l(e(d).usage.formattedCost),1)])])]),e(x)&&e(x).length>0?(r(),i("div",ta,[n[8]||(n[8]=t("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),t("span",ea,l(e(x).length)+" 个无效的 API Key ",1)])):K("",!0),n[9]||(n[9]=t("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[t("i",{class:"fas fa-info-circle mr-1"}),h(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):K("",!0),e(v)?K("",!0):(r(),i("div",sa,[t("div",null,[t("div",aa,[n[11]||(n[11]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),t("span",ra,[e(s).limits.dailyCostLimit>0?(r(),i("span",la," $"+l(e(s).limits.currentDailyCost.toFixed(4))+" / $"+l(e(s).limits.dailyCostLimit.toFixed(2)),1)):(r(),i("span",ia,[h(" $"+l(e(s).limits.currentDailyCost.toFixed(4))+" / ",1),n[10]||(n[10]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.dailyCostLimit>0?(r(),i("div",oa,[t("div",{class:A(["h-2 rounded-full transition-all duration-300",P()]),style:lt({width:$()+"%"})},null,6)])):(r(),i("div",na,n[12]||(n[12]=[t("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),t("div",null,[t("div",da,[n[14]||(n[14]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),t("span",ua,[e(s).limits.totalCostLimit>0?(r(),i("span",ca," $"+l(e(s).limits.currentTotalCost.toFixed(4))+" / $"+l(e(s).limits.totalCostLimit.toFixed(2)),1)):(r(),i("span",ma,[h(" $"+l(e(s).limits.currentTotalCost.toFixed(4))+" / ",1),n[13]||(n[13]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.totalCostLimit>0?(r(),i("div",ga,[t("div",{class:A(["h-2 rounded-full transition-all duration-300",T()]),style:lt({width:y()+"%"})},null,6)])):(r(),i("div",xa,n[15]||(n[15]=[t("div",{class:"h-2 rounded-full bg-blue-500",style:{width:"0%"}},null,-1)])))]),e(s).limits.weeklyOpusCostLimit>0?(r(),i("div",fa,[t("div",ya,[n[16]||(n[16]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Opus 模型周费用限制",-1)),t("span",pa," $"+l(e(s).limits.weeklyOpusCost.toFixed(4))+" / $"+l(e(s).limits.weeklyOpusCostLimit.toFixed(2)),1)]),t("div",va,[t("div",{class:A(["h-2 rounded-full transition-all duration-300",S()]),style:lt({width:E()+"%"})},null,6)])])):K("",!0),e(s).limits.rateLimitWindow>0&&(e(s).limits.rateLimitRequests>0||e(s).limits.tokenLimit>0||e(s).limits.rateLimitCost>0)?(r(),i("div",ba,[Q(Tt,{"cost-limit":e(s).limits.rateLimitCost,"current-cost":e(s).limits.currentWindowCost,"current-requests":e(s).limits.currentWindowRequests,"current-tokens":e(s).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":e(s).limits.rateLimitWindow,"request-limit":e(s).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":e(s).limits.tokenLimit,"window-end-time":e(s).limits.windowEndTime,"window-remaining-seconds":e(s).limits.windowRemainingSeconds,"window-start-time":e(s).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),t("div",ka,[n[17]||(n[17]=t("i",{class:"fas fa-info-circle mr-1"},null,-1)),e(s).limits.rateLimitCost>0?(r(),i("span",ha,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):e(s).limits.tokenLimit>0?(r(),i("span",_a,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(r(),i("span",wa," 仅限制请求次数 "))])])):K("",!0),t("div",$a,[t("div",Sa,[n[19]||(n[19]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),t("span",Ca,[e(s).limits.concurrencyLimit>0?(r(),i("span",Ka,l(e(s).limits.concurrencyLimit),1)):(r(),i("span",Ta,n[18]||(n[18]=[t("i",{class:"fas fa-infinity text-gray-400"},null,-1)])))])]),t("div",Aa,[n[22]||(n[22]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),t("span",Pa,[g.value?(r(),i("span",La,[n[20]||(n[20]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),h(" 限制 "+l(e(s).restrictions.restrictedModels.length)+" 个模型 ",1)])):(r(),i("span",Ia,n[21]||(n[21]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),h(" 允许所有模型 ",-1)])))])]),t("div",Ma,[t("div",Da,[n[25]||(n[25]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),t("span",qa,[p.value?(r(),i("span",ja,[n[23]||(n[23]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),h(" 限 "+l(e(s).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(r(),i("span",Ua,n[24]||(n[24]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),h(" 允许所有客户端 ",-1)])))])]),p.value?(r(),i("div",Ra,[(r(!0),i(X,null,et(e(s).restrictions.allowedClients,M=>(r(),i("span",{key:M,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-blue-700 shadow-sm dark:bg-slate-900 dark:text-blue-300 md:text-sm"},[n[26]||(n[26]=t("i",{class:"fas fa-id-badge"},null,-1)),h(" "+l(M),1)]))),128))])):K("",!0)])])]))]),g.value?(r(),i("div",Na,[n[30]||(n[30]=t("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[t("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),h(" 详细限制信息 ")],-1)),t("div",Oa,[n[28]||(n[28]=t("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[t("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),h(" 受限模型列表 ")],-1)),t("div",Ea,[(r(!0),i(X,null,et(e(s).restrictions.restrictedModels,M=>(r(),i("div",{key:M,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[n[27]||(n[27]=t("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),t("span",Fa,l(M),1)]))),128))]),n[29]||(n[29]=t("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[t("i",{class:"fas fa-info-circle mr-1"}),h(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):K("",!0)]))}},Ba=at(Wa,[["__scopeId","data-v-9bba2ba4"]]),Va={class:"card h-full p-4 md:p-6"},za={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},Ja={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Ya={key:0,class:"space-y-2 md:space-y-3"},Ha={class:"mb-1 flex items-center justify-between text-sm"},Ga={class:"truncate font-medium text-gray-700 dark:text-gray-300"},Qa={class:"text-xs text-gray-600 dark:text-gray-400"},Xa={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Za={class:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},tr={key:0,class:"border-t border-gray-200 pt-2 dark:border-gray-700"},er={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400"},sr={key:1,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},ar={key:2,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},rr={__name:"AggregatedStatsCard",setup(O){const b=rt(),{aggregatedStats:s,individualStats:v,statsPeriod:d,multiKeyMode:x}=st(b),g=S=>S?d.value==="daily"?S.dailyUsage||S.usage:S.monthlyUsage||S.usage:null,p=j(()=>!v.value||v.value.length===0?[]:[...v.value].sort((S,w)=>{const u=g(S),n=g(w);return((n==null?void 0:n.cost)||0)-((u==null?void 0:u.cost)||0)}).slice(0,5)),$=j(()=>v.value?Math.max(0,v.value.length-5):0),P=j(()=>{var n,M;if(!v.value||!s.value)return 0;const S=p.value.reduce((F,Y)=>{const V=g(Y);return F+((V==null?void 0:V.cost)||0)},0),w=d.value==="daily"?((n=s.value.dailyUsage)==null?void 0:n.cost)||0:((M=s.value.monthlyUsage)==null?void 0:M.cost)||0;if(w===0)return 0;const u=w-S;return Math.max(0,Math.round(u/w*100))}),y=S=>{var M,F;if(!s.value)return 0;const w=d.value==="daily"?((M=s.value.dailyUsage)==null?void 0:M.cost)||0:((F=s.value.monthlyUsage)==null?void 0:F.cost)||0;if(w===0)return 0;const u=g(S),n=((u==null?void 0:u.cost)||0)/w*100;return Math.round(n)},T=S=>["bg-blue-500","bg-green-500","bg-purple-500","bg-yellow-500","bg-pink-500"][S]||"bg-gray-400",E=S=>(typeof S!="number"&&(S=parseInt(S)||0),S===0?"0":S>=1e6?(S/1e6).toFixed(1)+"M":S>=1e3?(S/1e3).toFixed(1)+"K":S.toLocaleString());return(S,w)=>(r(),i("div",Va,[t("h3",za,[w[0]||(w[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-sm text-orange-500 md:mr-3 md:text-base"}),h(" 使用占比 ")],-1)),t("span",Ja,"("+l(e(d)==="daily"?"今日":"本月")+")",1)]),e(s)&&e(v).length>0?(r(),i("div",Ya,[(r(!0),i(X,null,et(p.value,(u,n)=>{var M,F;return r(),i("div",{key:u.apiId,class:"relative"},[t("div",Ha,[t("span",Ga,l(u.name||`Key ${n+1}`),1),t("span",Qa,l(y(u))+"% ",1)]),t("div",Xa,[t("div",{class:A(["h-2 rounded-full transition-all duration-300",T(n)]),style:lt({width:y(u)+"%"})},null,6)]),t("div",Za,[t("span",null,l(E(((M=g(u))==null?void 0:M.requests)||0))+"次",1),t("span",null,l(((F=g(u))==null?void 0:F.formattedCost)||"$0.00"),1)])])}),128)),$.value>0?(r(),i("div",tr,[t("div",er,[t("span",null,"其他 "+l($.value)+" 个Keys",1),t("span",null,l(P.value)+"%",1)])])):K("",!0)])):e(x)?(r(),i("div",ar,w[2]||(w[2]=[t("i",{class:"fas fa-chart-pie mr-2"},null,-1),h(" 暂无数据 ",-1)]))):(r(),i("div",sr,w[1]||(w[1]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-chart-pie mb-2 text-2xl"}),t("p",null,"使用占比仅在多Key查询时显示")],-1)])))]))}},lr=at(rr,[["__scopeId","data-v-39572a8e"]]),ir={class:"card p-4 md:p-6"},or={class:"mb-4 md:mb-6"},nr={class:"flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:text-xl"},dr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},ur={key:0,class:"py-6 text-center md:py-8"},cr={key:1,class:"space-y-3 md:space-y-4"},mr={class:"mb-2 flex items-start justify-between md:mb-3"},gr={class:"min-w-0 flex-1"},xr={class:"break-all text-base font-bold text-gray-900 dark:text-gray-100 md:text-lg"},fr={class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},yr={class:"ml-3 flex-shrink-0 text-right"},pr={class:"text-base font-bold text-green-600 md:text-lg"},vr={class:"grid grid-cols-2 gap-2 text-xs md:grid-cols-4 md:gap-3 md:text-sm"},br={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},kr={class:"font-medium text-gray-900 dark:text-gray-100"},hr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},_r={class:"font-medium text-gray-900 dark:text-gray-100"},wr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},$r={class:"font-medium text-gray-900 dark:text-gray-100"},Sr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Cr={class:"font-medium text-gray-900 dark:text-gray-100"},Kr={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},Tr={class:"text-sm md:text-base"},Ar={__name:"ModelUsageStats",setup(O){const b=rt(),{statsPeriod:s,modelStats:v,modelStatsLoading:d}=st(b),x=g=>(typeof g!="number"&&(g=parseInt(g)||0),g===0?"0":g>=1e6?(g/1e6).toFixed(1)+"M":g>=1e3?(g/1e3).toFixed(1)+"K":g.toLocaleString());return(g,p)=>(r(),i("div",ir,[t("div",or,[t("h3",nr,[p[0]||(p[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-robot mr-2 text-sm text-indigo-500 md:mr-3 md:text-base"}),h(" 模型使用统计 ")],-1)),t("span",dr,"("+l(e(s)==="daily"?"今日":"本月")+")",1)])]),e(d)?(r(),i("div",ur,p[1]||(p[1]=[t("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)]))):e(v).length>0?(r(),i("div",cr,[(r(!0),i(X,null,et(e(v),($,P)=>{var y;return r(),i("div",{key:P,class:"model-usage-item"},[t("div",mr,[t("div",gr,[t("h4",xr,l($.model),1),t("p",fr,l($.requests)+" 次请求 ",1)]),t("div",yr,[t("div",pr,l(((y=$.formatted)==null?void 0:y.total)||"$0.000000"),1),p[2]||(p[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},"总费用",-1))])]),t("div",vr,[t("div",br,[p[3]||(p[3]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输入 Token",-1)),t("div",kr,l(x($.inputTokens)),1)]),t("div",hr,[p[4]||(p[4]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输出 Token",-1)),t("div",_r,l(x($.outputTokens)),1)]),t("div",wr,[p[5]||(p[5]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存创建",-1)),t("div",$r,l(x($.cacheCreateTokens)),1)]),t("div",Sr,[p[6]||(p[6]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存读取",-1)),t("div",Cr,l(x($.cacheReadTokens)),1)])])])}),128))])):(r(),i("div",Kr,[p[7]||(p[7]=t("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),t("p",Tr," 暂无"+l(e(s)==="daily"?"今日":"本月")+"模型使用数据 ",1)]))]))}},Pr=at(Ar,[["__scopeId","data-v-b3b8dc5f"]]),Lr={key:0,class:"fixed inset-0 z-[1050] flex items-center justify-center bg-gray-900/40 backdrop-blur-sm"},Ir={class:"relative z-10 mx-3 flex w-full max-w-lg flex-col overflow-hidden rounded-2xl border border-gray-200/70 bg-white/95 shadow-2xl ring-1 ring-black/5 transition-all dark:border-gray-700/60 dark:bg-gray-900/95 dark:ring-white/10 sm:mx-4"},Mr={class:"flex items-center justify-between border-b border-gray-100 bg-white/80 px-5 py-4 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},Dr={class:"flex items-center gap-3"},qr={class:"text-xs text-gray-500 dark:text-gray-400"},jr=["disabled"],Ur={class:"max-h-[70vh] overflow-y-auto px-5 py-4"},Rr={class:"mb-4"},Nr={class:"relative"},Or=["value"],Er={class:"mb-4 space-y-2"},Fr={class:"flex items-center justify-between text-sm"},Wr={class:"font-medium text-gray-700 dark:text-gray-300"},Br={class:"flex items-center gap-3"},Vr={class:"text-xs text-gray-500 dark:text-gray-400"},zr={key:0,class:"mb-4 overflow-hidden rounded-xl border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"},Jr={class:"flex items-center justify-between border-b border-gray-200 bg-gray-100 px-3 py-2 dark:border-gray-700 dark:bg-gray-800"},Yr={key:0,class:"text-xs text-gray-500 dark:text-gray-500"},Hr={class:"max-h-40 overflow-y-auto p-3"},Gr={key:0,class:"whitespace-pre-wrap text-sm text-gray-700 dark:text-gray-300"},Qr={key:0,class:"inline-block h-4 w-1 animate-pulse bg-blue-500"},Xr={key:1,class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400"},Zr={key:2,class:"text-sm text-red-600 dark:text-red-400"},tl={key:1,class:"mb-4 flex items-center justify-center gap-2 text-xs text-gray-500 dark:text-gray-400"},el={class:"flex items-center justify-end gap-3 border-t border-gray-100 bg-gray-50/80 px-5 py-3 dark:border-gray-800 dark:bg-gray-900/50"},sl=["disabled"],al=["disabled"],rl={__name:"ApiKeyTestModal",props:{show:{type:Boolean,default:!1},apiKeyValue:{type:String,default:""},apiKeyName:{type:String,default:""}},emits:["close"],setup(O,{emit:b}){const s=O,v=b,d=L("idle"),x=L(""),g=L(""),p=L(0),$=L(null),P=L(null),y=L("claude-sonnet-4-5-20250929"),T=j(()=>s.apiKeyName||"当前 API Key"),E=j(()=>{const D=s.apiKeyValue;return D?D.length<=10?"****":D.substring(0,6)+"****"+D.substring(D.length-4):""}),S=j(()=>{switch(d.value){case"idle":return"准备就绪";case"testing":return"正在测试...";case"success":return"测试成功";case"error":return"测试失败";default:return"未知状态"}}),w=j(()=>{switch(d.value){case"idle":return"点击下方按钮开始测试 API Key 连通性";case"testing":return"正在通过 /api 端点发送测试请求";case"success":return"API Key 可以正常访问服务";case"error":return g.value||"无法通过 API Key 访问服务";default:return""}}),u=j(()=>{switch(d.value){case"idle":return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50";case"testing":return"border-blue-200 bg-blue-50 dark:border-blue-500/30 dark:bg-blue-900/20";case"success":return"border-green-200 bg-green-50 dark:border-green-500/30 dark:bg-green-900/20";case"error":return"border-red-200 bg-red-50 dark:border-red-500/30 dark:bg-red-900/20";default:return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"}}),n=j(()=>{switch(d.value){case"idle":return"bg-gray-200 dark:bg-gray-700";case"testing":return"bg-blue-100 dark:bg-blue-500/30";case"success":return"bg-green-100 dark:bg-green-500/30";case"error":return"bg-red-100 dark:bg-red-500/30";default:return"bg-gray-200 dark:bg-gray-700"}}),M=j(()=>{switch(d.value){case"idle":return"fa-hourglass-start";case"testing":return"fa-spinner fa-spin";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";default:return"fa-question-circle"}}),F=j(()=>{switch(d.value){case"idle":return"text-gray-500 dark:text-gray-400";case"testing":return"text-blue-500 dark:text-blue-400";case"success":return"text-green-500 dark:text-green-400";case"error":return"text-red-500 dark:text-red-400";default:return"text-gray-500 dark:text-gray-400"}}),Y=j(()=>{switch(d.value){case"idle":return"text-gray-700 dark:text-gray-300";case"testing":return"text-blue-700 dark:text-blue-300";case"success":return"text-green-700 dark:text-green-300";case"error":return"text-red-700 dark:text-red-300";default:return"text-gray-700 dark:text-gray-300"}});async function V(){if(!s.apiKeyValue)return;d.value="testing",x.value="",g.value="",p.value=0,$.value=Date.now(),P.value&&P.value.abort(),P.value=new AbortController;const D=`${wt}/apiStats/api-key/test`;try{const k=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:s.apiKeyValue,model:y.value}),signal:P.value.signal});if(!k.ok){const z=await k.json().catch(()=>({}));throw new Error(z.message||z.error||`HTTP ${k.status}`)}const H=k.body.getReader(),tt=new TextDecoder;let Z=!1;for(;!Z;){const{done:z,value:U}=await H.read();if(z){Z=!0;continue}const o=tt.decode(U).split(`
`);for(const a of o)if(a.startsWith("data: "))try{const m=JSON.parse(a.substring(6));B(m)}catch{}}}catch(k){if(k.name==="AbortError")return;d.value="error",g.value=k.message||"连接失败",p.value=Date.now()-$.value}}function B(D){switch(D.type){case"test_start":break;case"content":x.value+=D.text;break;case"message_stop":break;case"test_complete":p.value=Date.now()-$.value,D.success?d.value="success":(d.value="error",g.value=D.error||"测试失败");break;case"error":d.value="error",g.value=D.error||"未知错误",p.value=Date.now()-$.value;break}}function R(){d.value!=="testing"&&(P.value&&(P.value.abort(),P.value=null),d.value="idle",x.value="",g.value="",p.value=0,v("close"))}return yt(()=>s.show,D=>{D&&(d.value="idle",x.value="",g.value="",p.value=0)}),pt(()=>{P.value&&P.value.abort()}),(D,k)=>(r(),ot(bt,{to:"body"},[O.show?(r(),i("div",Lr,[t("div",{class:"absolute inset-0",onClick:R}),t("div",Ir,[t("div",Mr,[t("div",Dr,[t("div",{class:A(["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl text-white shadow-lg",d.value==="success"?"bg-gradient-to-br from-green-500 to-emerald-500":d.value==="error"?"bg-gradient-to-br from-red-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[t("i",{class:A(["fas",d.value==="idle"?"fa-vial":d.value==="testing"?"fa-spinner fa-spin":d.value==="success"?"fa-check":"fa-times"])},null,2)],2),t("div",null,[k[0]||(k[0]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"}," API Key 端点测试 ",-1)),t("p",qr,l(T.value),1)])]),t("button",{class:"flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 text-gray-500 transition hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200",disabled:d.value==="testing",onClick:R},k[1]||(k[1]=[t("i",{class:"fas fa-times text-sm"},null,-1)]),8,jr)]),t("div",Ur,[t("div",Rr,[k[3]||(k[3]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),t("div",Nr,[t("input",{class:"w-full rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 pr-10 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",readonly:"",type:"text",value:E.value},null,8,Or),k[2]||(k[2]=t("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"},[t("i",{class:"fas fa-lock text-xs"})],-1))]),k[4]||(k[4]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 测试将使用此 API Key 调用当前服务的 /api 端点 ",-1))]),t("div",Er,[k[6]||(k[6]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"测试端点"),t("span",{class:"inline-flex items-center gap-1.5 rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:bg-blue-500/20 dark:text-blue-300"},[t("i",{class:"fas fa-link"}),h(" /api/v1/messages ")])],-1)),t("div",Fr,[k[5]||(k[5]=t("span",{class:"text-gray-500 dark:text-gray-400"},"测试模型",-1)),t("span",Wr,l(y.value),1)]),k[7]||(k[7]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"模拟客户端"),t("span",{class:"font-medium text-gray-700 dark:text-gray-300"},"Claude Code")],-1))]),t("div",{class:A(["mb-4 rounded-xl border p-4 transition-all duration-300",u.value])},[t("div",Br,[t("div",{class:A(["flex h-8 w-8 items-center justify-center rounded-lg",n.value])},[t("i",{class:A(["fas text-sm",M.value,F.value])},null,2)],2),t("div",null,[t("p",{class:A(["font-medium",Y.value])},l(S.value),3),t("p",Vr,l(w.value),1)])])],2),d.value!=="idle"?(r(),i("div",zr,[t("div",Jr,[k[8]||(k[8]=t("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"AI 响应",-1)),x.value?(r(),i("span",Yr,l(x.value.length)+" 字符 ",1)):K("",!0)]),t("div",Hr,[x.value?(r(),i("p",Gr,[h(l(x.value)+" ",1),d.value==="testing"?(r(),i("span",Qr)):K("",!0)])):d.value==="testing"?(r(),i("p",Xr,k[9]||(k[9]=[t("i",{class:"fas fa-circle-notch fa-spin"},null,-1),h(" 等待响应中... ",-1)]))):d.value==="error"&&g.value?(r(),i("p",Zr,l(g.value),1)):K("",!0)])])):K("",!0),p.value>0?(r(),i("div",tl,[k[10]||(k[10]=t("i",{class:"fas fa-clock"},null,-1)),t("span",null,"耗时 "+l((p.value/1e3).toFixed(2))+" 秒",1)])):K("",!0)]),t("div",el,[t("button",{class:"rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 hover:shadow dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:d.value==="testing",onClick:R}," 关闭 ",8,sl),t("button",{class:A(["flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium shadow-sm transition",d.value==="testing"||!O.apiKeyValue?"cursor-not-allowed bg-gray-200 text-gray-400 dark:bg-gray-700 dark:text-gray-500":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600 hover:shadow-md"]),disabled:d.value==="testing"||!O.apiKeyValue,onClick:V},[t("i",{class:A(["fas",d.value==="testing"?"fa-spinner fa-spin":"fa-play"])},null,2),h(" "+l(d.value==="testing"?"测试中...":d.value==="idle"?"开始测试":"重新测试"),1)],10,al)])])])):K("",!0)]))}},ll={class:"glass-strong mb-6 rounded-3xl p-4 shadow-xl md:mb-8 md:p-6"},il={class:"flex flex-col items-center justify-between gap-4 md:flex-row"},ol={class:"flex items-center gap-2 md:gap-4"},nl={class:"flex items-center"},dl={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},ul={class:"mb-6 md:mb-8"},cl={class:"flex justify-center"},ml={class:"inline-flex w-full max-w-md rounded-full border border-white/20 bg-white/10 p-1 shadow-lg backdrop-blur-xl md:w-auto"},gl={key:0,class:"tab-content"},xl={key:0,class:"mb-6 md:mb-8"},fl={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},yl={key:1,class:"fade-in"},pl={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},vl={class:"mb-4 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},bl={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-4"},kl={class:"flex w-full items-center gap-2 md:w-auto"},hl=["disabled"],_l=["disabled"],wl=["disabled"],$l={class:"mb-6 mt-6 grid grid-cols-1 gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},Sl={key:1,class:"tab-content"},Cl={class:"glass-strong rounded-3xl shadow-xl"},Kl={key:2,class:"tab-content"},Tl={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},Al={class:"mx-auto max-w-md"},Pl={class:"mb-4"},Ll={class:"mb-6"},Il=["disabled"],Ml={key:0,class:"fas fa-spinner fa-spin mr-2"},Dl={key:1,class:"fas fa-gift mr-2"},ql={class:"flex items-center gap-2"},jl={key:0,class:"mt-2 text-sm"},Ul={__name:"ApiStatsView",setup(O){const b=ht(),s=rt(),v=$t(),d=L("stats"),x=j(()=>v.isDarkMode),{apiKey:g,apiId:p,loading:$,modelStatsLoading:P,oemLoading:y,error:T,statsPeriod:E,statsData:S,oemSettings:w,multiKeyMode:u}=st(s),{queryStats:n,switchPeriod:M,loadStatsWithApiId:F,loadOemSettings:Y,reset:V}=s,B=L(!1),R=L({code:"",apiKey:""}),D=L(!1),k=L(null),H=async()=>{if(!R.value.code||!R.value.apiKey){k.value={success:!1,message:"请填写兑换码和 API Key"};return}D.value=!0,k.value=null;try{const f=await(await fetch("/api/v1/redeem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:R.value.code,apiKey:R.value.apiKey})})).json();f.success?(k.value={success:!0,message:"兑换成功！",data:f.data},R.value.code=""):k.value={success:!1,message:f.message||"兑换失败"}}catch{k.value={success:!1,message:"网络错误，请稍后重试"}}finally{D.value=!1}},tt=()=>{B.value=!0},Z=()=>{B.value=!1},z=U=>{(U.ctrlKey||U.metaKey)&&U.key==="Enter"&&(!$.value&&g.value.trim()&&n(),U.preventDefault()),U.key==="Escape"&&V()};return kt(()=>{v.initTheme(),Y();const U=b.query.apiId,f=b.query.apiKey;U&&U.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)?(p.value=U,F()):f&&f.length>10&&(g.value=f),document.addEventListener("keydown",z)}),pt(()=>{document.removeEventListener("keydown",z)}),yt(g,U=>{U||s.clearData()}),(U,f)=>{var a;const o=_t("router-link");return r(),i("div",{class:A(["min-h-screen p-4 md:p-6",x.value?"gradient-bg-dark":"gradient-bg"])},[t("div",ll,[t("div",il,[Q(St,{loading:e(y),"logo-src":e(w).siteIconData||e(w).siteIcon,subtitle:d.value==="stats"?"API Key 使用统计":"使用教程",title:e(w).siteName},null,8,["loading","logo-src","subtitle","title"]),t("div",ol,[t("div",nl,[Q(Ct,{mode:"dropdown"})]),e(w).ldapEnabled||e(w).showAdminButton!==!1?(r(),i("div",dl)):K("",!0),e(w).ldapEnabled?(r(),ot(o,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:xt(()=>f[7]||(f[7]=[t("i",{class:"fas fa-user text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])),_:1,__:[7]})):K("",!0),e(w).showAdminButton!==!1?(r(),ot(o,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:xt(()=>f[8]||(f[8]=[t("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])),_:1,__:[8]})):K("",!0)])])]),t("div",ul,[t("div",cl,[t("div",ml,[t("button",{class:A(["tab-pill-button",d.value==="stats"?"active":""]),onClick:f[0]||(f[0]=m=>d.value="stats")},f[9]||(f[9]=[t("i",{class:"fas fa-chart-line mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"统计查询",-1)]),2),t("button",{class:A(["tab-pill-button",d.value==="redeem"?"active":""]),onClick:f[1]||(f[1]=m=>d.value="redeem")},f[10]||(f[10]=[t("i",{class:"fas fa-ticket-alt mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"兑换额度",-1)]),2),t("button",{class:A(["tab-pill-button",d.value==="tutorial"?"active":""]),onClick:f[2]||(f[2]=m=>d.value="tutorial")},f[11]||(f[11]=[t("i",{class:"fas fa-graduation-cap mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"使用教程",-1)]),2)])])]),d.value==="stats"?(r(),i("div",gl,[Q(Gt),e(T)?(r(),i("div",xl,[t("div",fl,[f[12]||(f[12]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),h(" "+l(e(T)),1)])])):K("",!0),e(S)?(r(),i("div",yl,[t("div",pl,[t("div",vl,[t("div",bl,[f[16]||(f[16]=t("div",{class:"flex items-center gap-2 md:gap-3"},[t("i",{class:"fas fa-clock text-base text-blue-500 md:text-lg"}),t("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),t("div",kl,[t("button",{class:A(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(E)==="daily"}]]),disabled:e($)||e(P),onClick:f[3]||(f[3]=m=>e(M)("daily"))},f[13]||(f[13]=[t("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),h(" 今日 ",-1)]),10,hl),t("button",{class:A(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(E)==="monthly"}]]),disabled:e($)||e(P),onClick:f[4]||(f[4]=m=>e(M)("monthly"))},f[14]||(f[14]=[t("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),h(" 本月 ",-1)]),10,_l),e(u)?K("",!0):(r(),i("button",{key:0,class:"test-btn flex items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:gap-2 md:px-6 md:text-sm",disabled:e($),onClick:tt},f[15]||(f[15]=[t("i",{class:"fas fa-vial text-xs md:text-sm"},null,-1),h(" 测试 ",-1)]),8,wl))])])]),Q(fs),t("div",$l,[Q(Ms,{class:"h-full"}),e(u)?(r(),ot(lr,{key:0,class:"h-full"})):(r(),ot(Ba,{key:1,class:"h-full"}))]),Q(Pr)])])):K("",!0)])):K("",!0),d.value==="tutorial"?(r(),i("div",Sl,[t("div",Cl,[Q(At)])])):K("",!0),d.value==="redeem"?(r(),i("div",Kl,[t("div",Tl,[t("div",Al,[f[20]||(f[20]=t("h2",{class:"mb-6 text-center text-xl font-bold text-gray-900 dark:text-white"},[t("i",{class:"fas fa-ticket-alt mr-2 text-blue-500"}),h(" 兑换额度 ")],-1)),t("form",{onSubmit:ft(H,["prevent"])},[t("div",Pl,[f[17]||(f[17]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 兑换码 ",-1)),nt(t("input",{"onUpdate:modelValue":f[5]||(f[5]=m=>R.value.code=m),class:"w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"请输入兑换码",required:"",type:"text"},null,512),[[dt,R.value.code]])]),t("div",Ll,[f[18]||(f[18]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),nt(t("input",{"onUpdate:modelValue":f[6]||(f[6]=m=>R.value.apiKey=m),class:"w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"请输入您的 API Key",required:"",type:"text"},null,512),[[dt,R.value.apiKey]])]),t("button",{class:"btn btn-primary btn-query w-full",disabled:D.value,type:"submit"},[D.value?(r(),i("i",Ml)):(r(),i("i",Dl)),f[19]||(f[19]=h(" 兑换 ",-1))],8,Il)],32),k.value?(r(),i("div",{key:0,class:A(["mt-6 rounded-lg border p-4",k.value.success?"border-green-500/30 bg-green-500/10 text-green-700 dark:text-green-300":"border-red-500/30 bg-red-500/10 text-red-700 dark:text-red-300"])},[t("div",ql,[t("i",{class:A(k.value.success?"fas fa-check-circle":"fas fa-times-circle")},null,2),t("span",null,l(k.value.message),1)]),k.value.success&&k.value.data?(r(),i("div",jl,[t("p",null,"增加额度: $"+l(k.value.data.amount.toFixed(2)),1),t("p",null,"当前总额度: $"+l(k.value.data.newTotalLimit.toFixed(2)),1)])):K("",!0)],2)):K("",!0)])])])):K("",!0),Q(rl,{"api-key-name":((a=e(S))==null?void 0:a.name)||"","api-key-value":e(g),show:B.value,onClose:Z},null,8,["api-key-name","api-key-value","show"])],2)}}},zl=at(Ul,[["__scopeId","data-v-2634c377"]]);export{zl as default};
