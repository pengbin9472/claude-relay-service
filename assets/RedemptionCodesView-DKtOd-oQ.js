import{aP as se,r as v,_ as re,I as j,y as m,z as e,P as i,Y as T,x as k,L as A,K as _,an as q,aq as D,O as N,a5 as M,q as O,Q as K,ac as W,c as $,C as L,R as oe}from"./vue-vendor-R8HMg95E.js";import{c as R,s as h,_ as Q}from"./index-DCSNeyWU.js";import{C as ae}from"./ConfirmModal-C88bqKVn.js";import"./element-plus-BUfCkBQO.js";import"./vendor-Dr8jvgFu.js";const F=se("redemptionCodes",()=>{const p=v([]),u=v(!1),n=v(null),f=async(s={})=>{u.value=!0,n.value=null;try{const t=await R.get("/admin/redemption-codes",{params:s});if(t.success)p.value=t.data||[];else throw new Error(t.message||"获取兑换码列表失败")}catch(t){throw n.value=t.message,t}finally{u.value=!1}};return{codes:p,loading:u,error:n,fetchCodes:f,createCode:async s=>{u.value=!0;try{const t=await R.post("/admin/redemption-codes",s);if(t.success)return await f(),t.data;throw new Error(t.message||"创建兑换码失败")}catch(t){throw n.value=t.message,t}finally{u.value=!1}},batchCreateCodes:async s=>{u.value=!0;try{const t=await R.post("/admin/redemption-codes/batch",s);if(t.success)return await f(),t.data;throw new Error(t.message||"批量创建兑换码失败")}catch(t){throw n.value=t.message,t}finally{u.value=!1}},updateCode:async(s,t)=>{u.value=!0;try{const w=await R.put(`/admin/redemption-codes/${s}`,t);if(w.success)return await f(),w.data;throw new Error(w.message||"更新兑换码失败")}catch(w){throw n.value=w.message,w}finally{u.value=!1}},deleteCode:async s=>{u.value=!0;try{const t=await R.delete(`/admin/redemption-codes/${s}`);if(t.success)return await f(),t;throw new Error(t.message||"删除兑换码失败")}catch(t){throw n.value=t.message,t}finally{u.value=!1}},fetchRecords:async s=>{try{const t=await R.get(`/admin/redemption-codes/${s}/records`);if(t.success)return t.data||[];throw new Error(t.message||"获取兑换记录失败")}catch(t){throw n.value=t.message,t}}}}),le={class:"w-full max-w-lg rounded-xl bg-white p-6 shadow-2xl dark:bg-gray-800"},ne={class:"mb-6 flex items-center justify-between"},de={class:"text-xl font-semibold text-gray-900 dark:text-white"},ie={class:"mb-4"},ue={class:"flex gap-4"},ce={class:"flex cursor-pointer items-center gap-2"},xe={class:"flex cursor-pointer items-center gap-2"},ge={key:0,class:"mb-4"},me={class:"mb-4"},ye={class:"mb-4"},be={class:"mb-4"},fe={class:"mb-6"},pe={class:"flex justify-end gap-3"},ve=["disabled"],he={key:0,class:"fas fa-spinner fa-spin mr-2"},ke={__name:"CreateRedemptionCodeModal",emits:["close","created","batch-success"],setup(p,{emit:u}){const n=u,f=F(),y=v(!1),x=v(!1),l=re({name:"",amount:null,maxUses:1,expiresAt:"",count:10}),d=async()=>{if(!l.amount||l.amount<=0){h("请输入有效的额度","error");return}y.value=!0;try{const g={name:l.name||"兑换码",amount:l.amount,maxUses:l.maxUses||0,expiresAt:l.expiresAt?new Date(l.expiresAt).toISOString():null};let s;x.value?(s=await f.batchCreateCodes({...g,count:l.count}),h(`成功创建 ${s.length} 个兑换码`,"success"),n("batch-success",s)):(s=await f.createCode(g),h(`兑换码创建成功: ${s.code}`,"success")),n("created",s),n("close")}catch(g){h("创建失败: "+g.message,"error")}finally{y.value=!1}};return(g,s)=>(m(),j(M,{to:"body"},[e("div",{class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:s[9]||(s[9]=T(t=>g.$emit("close"),["self"]))},[e("div",le,[e("div",ne,[e("h3",de,i(x.value?"批量创建兑换码":"创建兑换码"),1),e("button",{class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-700 dark:hover:text-gray-300",onClick:s[0]||(s[0]=t=>g.$emit("close"))},s[10]||(s[10]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("form",{onSubmit:T(d,["prevent"])},[e("div",ie,[s[13]||(s[13]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 创建模式 ",-1)),e("div",ue,[e("label",ce,[_(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>x.value=t),class:"text-blue-500",type:"radio",value:!1},null,512),[[q,x.value]]),s[11]||(s[11]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"单个创建",-1))]),e("label",xe,[_(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>x.value=t),class:"text-blue-500",type:"radio",value:!0},null,512),[[q,x.value]]),s[12]||(s[12]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"批量创建",-1))])])]),x.value?(m(),k("div",ge,[s[14]||(s[14]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 创建数量 ",-1)),_(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>l.count=t),class:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",max:"100",min:"1",type:"number"},null,512),[[D,l.count,void 0,{number:!0}]])])):A("",!0),e("div",me,[s[15]||(s[15]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 名称 ",-1)),_(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>l.name=t),class:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"例如：新年促销码",type:"text"},null,512),[[D,l.name]])]),e("div",ye,[s[16]||(s[16]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"},[N(" 额度（美元）"),e("span",{class:"text-red-500"},"*")],-1)),_(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>l.amount=t),class:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0.01",placeholder:"例如：10.00",required:"",step:"0.01",type:"number"},null,512),[[D,l.amount,void 0,{number:!0}]])]),e("div",be,[s[17]||(s[17]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 最大使用次数 ",-1)),_(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>l.maxUses=t),class:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",min:"0",placeholder:"0 表示无限制",type:"number"},null,512),[[D,l.maxUses,void 0,{number:!0}]]),s[18]||(s[18]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 0 表示无限制，每个 API Key 只能使用一次 ",-1))]),e("div",fe,[s[19]||(s[19]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 过期时间（可选） ",-1)),_(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>l.expiresAt=t),class:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",type:"datetime-local"},null,512),[[D,l.expiresAt]])]),e("div",pe,[e("button",{class:"rounded-lg border border-gray-300 px-4 py-2 text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",type:"button",onClick:s[8]||(s[8]=t=>g.$emit("close"))}," 取消 "),e("button",{class:"rounded-lg bg-blue-500 px-4 py-2 text-white hover:bg-blue-600 disabled:cursor-not-allowed disabled:opacity-50",disabled:y.value,type:"submit"},[y.value?(m(),k("i",he)):A("",!0),N(" "+i(x.value?"批量创建":"创建"),1)],8,ve)])],32)])])]))}},we={class:"w-full max-w-2xl rounded-xl bg-white p-6 shadow-2xl dark:bg-gray-800"},$e={class:"mb-6 flex items-center justify-between"},Ce={class:"text-xl font-semibold text-gray-900 dark:text-white"},_e={key:0,class:"flex items-center justify-center py-8"},Ae={key:1,class:"py-8 text-center text-gray-500 dark:text-gray-400"},je={key:2,class:"max-h-96 overflow-y-auto"},Ue={class:"w-full"},Se={class:"divide-y divide-gray-200 dark:divide-gray-600"},Ne={class:"px-4 py-3 text-sm text-gray-900 dark:text-white"},Re={class:"px-4 py-3 text-sm text-green-600 dark:text-green-400"},De={class:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400"},Te={class:"mt-6 flex justify-end"},Me={__name:"RedemptionRecordsModal",props:{codeId:{type:String,required:!0},codeName:{type:String,default:""}},emits:["close"],setup(p){const u=p,n=F(),f=v(!0),y=v([]),x=l=>l?new Date(l).toLocaleString("zh-CN"):"-";return O(async()=>{try{y.value=await n.fetchRecords(u.codeId)}catch(l){console.error("获取兑换记录失败:",l)}finally{f.value=!1}}),(l,d)=>(m(),j(M,{to:"body"},[e("div",{class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:d[2]||(d[2]=T(g=>l.$emit("close"),["self"]))},[e("div",we,[e("div",$e,[e("h3",Ce," 兑换记录 - "+i(p.codeName),1),e("button",{class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-700 dark:hover:text-gray-300",onClick:d[0]||(d[0]=g=>l.$emit("close"))},d[3]||(d[3]=[e("i",{class:"fas fa-times"},null,-1)]))]),f.value?(m(),k("div",_e,d[4]||(d[4]=[e("i",{class:"fas fa-spinner fa-spin text-2xl text-blue-500"},null,-1)]))):y.value.length===0?(m(),k("div",Ae,d[5]||(d[5]=[e("i",{class:"fas fa-inbox mb-2 text-4xl"},null,-1),e("p",null,"暂无兑换记录",-1)]))):(m(),k("div",je,[e("table",Ue,[d[6]||(d[6]=e("thead",{class:"sticky top-0 bg-gray-50 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," API Key "),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," 额度 "),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," 兑换时间 ")])],-1)),e("tbody",Se,[(m(!0),k(K,null,W(y.value,g=>(m(),k("tr",{key:g.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50"},[e("td",Ne,i(g.apiKeyName),1),e("td",Re," +$"+i(g.amount.toFixed(2)),1),e("td",De,i(x(g.redeemedAt)),1)]))),128))])])])),e("div",Te,[e("button",{class:"rounded-lg border border-gray-300 px-4 py-2 text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",onClick:d[1]||(d[1]=g=>l.$emit("close"))}," 关闭 ")])])])]))}},Ve={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},Ee={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-2xl overflow-y-auto p-8"},Be={class:"mb-6 flex items-center justify-between"},ze={class:"flex items-center gap-3"},Ie={class:"text-sm text-gray-600"},Le={class:"mb-6 grid grid-cols-2 gap-4 md:grid-cols-4"},Fe={class:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 p-4"},Pe={class:"flex items-center justify-between"},qe={class:"mt-1 text-2xl font-bold text-blue-900"},Oe={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 p-4"},Ke={class:"flex items-center justify-between"},We={class:"mt-1 text-lg font-bold text-green-900"},Qe={class:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 p-4"},Ye={class:"flex items-center justify-between"},Ge={class:"mt-1 text-lg font-bold text-purple-900"},He={class:"rounded-lg border border-orange-200 bg-gradient-to-br from-orange-50 to-orange-100 p-4"},Je={class:"flex items-center justify-between"},Xe={class:"mt-1 text-lg font-bold text-orange-900"},Ze={class:"mb-6"},et={class:"mb-3 flex items-center justify-between"},tt={class:"flex items-center gap-2"},st={key:0,class:"custom-scrollbar max-h-48 overflow-y-auto rounded-lg bg-gray-900 p-4"},rt={class:"font-mono text-xs text-gray-300"},ot={class:"flex gap-3"},at={__name:"BatchRedemptionCodeModal",props:{codes:{type:Array,required:!0}},emits:["close"],setup(p,{emit:u}){const n=p,f=u,y=v(!1),x=$(()=>n.codes.length>0?n.codes[0]:null),l=$(()=>!x.value||typeof x.value.amount!="number"?"-":x.value.amount.toFixed(2)),d=$(()=>{if(!x.value)return"-";const b=x.value.maxUses;return b===0?"无限制":String(b||"-")}),g=$(()=>{if(!x.value||!x.value.expiresAt)return"永不过期";const b=new Date(x.value.expiresAt);return Number.isNaN(b.getTime())?"-":b.toLocaleDateString("zh-CN")}),s=()=>{y.value=!y.value},t=$(()=>{const r=n.codes.slice(0,10).map(C=>`${C.name||"兑换码"}: ${C.code}`);return n.codes.length>10&&r.push(`... 还有 ${n.codes.length-10} 个兑换码`),r.join(`
`)}),w=()=>{const b=n.codes.map(E=>E.code).join(`
`),r=new Blob([b],{type:"text/plain;charset=utf-8"}),C=URL.createObjectURL(r),U=document.createElement("a");U.href=C;const V=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);U.download=`redemption-codes-${V}.txt`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(C),h("兑换码文件已下载","success")};return(b,r)=>(m(),j(M,{to:"body"},[e("div",Ve,[e("div",Ee,[e("div",Be,[e("div",ze,[r[3]||(r[3]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-ticket-alt text-lg text-white"})],-1)),e("div",null,[r[2]||(r[2]=e("h3",{class:"text-xl font-bold text-gray-900"},"批量创建成功",-1)),e("p",Ie,"成功创建 "+i(p.codes.length)+" 个兑换码",1)])]),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",title:"关闭",onClick:r[0]||(r[0]=C=>f("close"))},r[4]||(r[4]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),r[16]||(r[16]=e("div",{class:"mb-6 border-l-4 border-blue-400 bg-blue-50 p-4"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg bg-blue-400"},[e("i",{class:"fas fa-info-circle text-sm text-white"})]),e("div",{class:"ml-3"},[e("h5",{class:"mb-1 font-semibold text-blue-900"},"提示"),e("p",{class:"text-sm text-blue-800"},"建议立即下载并保存兑换码清单，便于分发和管理。")])])],-1)),e("div",Le,[e("div",Fe,[e("div",Pe,[e("div",null,[r[5]||(r[5]=e("p",{class:"text-xs font-medium text-blue-600"},"创建数量",-1)),e("p",qe,i(p.codes.length),1)]),r[6]||(r[6]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-500 bg-opacity-20"},[e("i",{class:"fas fa-ticket-alt text-blue-600"})],-1))])]),e("div",Oe,[e("div",Ke,[e("div",null,[r[7]||(r[7]=e("p",{class:"text-xs font-medium text-green-600"},"额度",-1)),e("p",We,"$"+i(l.value),1)]),r[8]||(r[8]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-green-500 bg-opacity-20"},[e("i",{class:"fas fa-coins text-green-600"})],-1))])]),e("div",Qe,[e("div",Ye,[e("div",null,[r[9]||(r[9]=e("p",{class:"text-xs font-medium text-purple-600"},"最大使用次数",-1)),e("p",Ge,i(d.value),1)]),r[10]||(r[10]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-purple-500 bg-opacity-20"},[e("i",{class:"fas fa-sync-alt text-purple-600"})],-1))])]),e("div",He,[e("div",Je,[e("div",null,[r[11]||(r[11]=e("p",{class:"text-xs font-medium text-orange-600"},"过期时间",-1)),e("p",Xe,i(g.value),1)]),r[12]||(r[12]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-orange-500 bg-opacity-20"},[e("i",{class:"fas fa-clock text-orange-600"})],-1))])])]),e("div",Ze,[e("div",et,[r[14]||(r[14]=e("label",{class:"text-sm font-semibold text-gray-700"},"兑换码预览",-1)),e("div",tt,[e("button",{class:"flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800",type:"button",onClick:s},[e("i",{class:L(["fas",y.value?"fa-eye-slash":"fa-eye"])},null,2),N(" "+i(y.value?"隐藏":"显示")+"预览 ",1)]),r[13]||(r[13]=e("span",{class:"text-xs text-gray-500"},"（最多显示前10个）",-1))])]),y.value?(m(),k("div",st,[e("pre",rt,i(t.value),1)])):A("",!0)]),e("div",ot,[e("button",{class:"btn btn-primary flex flex-1 items-center justify-center gap-2 px-6 py-3 font-semibold",onClick:w},r[15]||(r[15]=[e("i",{class:"fas fa-download"},null,-1),N(" 下载兑换码 ",-1)])),e("button",{class:"rounded-xl border border-gray-300 bg-gray-200 px-6 py-3 font-semibold text-gray-800 transition-colors hover:bg-gray-300",onClick:r[1]||(r[1]=C=>f("close"))}," 关闭 ")]),r[17]||(r[17]=e("div",{class:"mt-4 rounded-lg border border-blue-200 bg-blue-50 p-3"},[e("p",{class:"flex items-start text-xs text-blue-700"},[e("i",{class:"fas fa-info-circle mr-2 mt-0.5 flex-shrink-0"}),e("span",null,"下载的文件为文本文件（.txt），每行包含一个兑换码。")])],-1))])])]))}},lt=Q(at,[["__scopeId","data-v-167c03b4"]]),nt={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},dt={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-lg overflow-y-auto p-8"},it={class:"mb-6 flex items-center justify-between"},ut={class:"mb-6 space-y-4"},ct={class:"rounded-lg border border-gray-200 bg-gray-50 p-3"},xt={class:"font-medium text-gray-900"},gt={class:"relative"},mt={class:"flex min-h-[52px] items-center break-all rounded-lg border border-gray-700 bg-gray-900 p-4 pr-14 font-mono text-sm text-white"},yt={class:"absolute right-3 top-3"},bt=["disabled"],ft={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},pt={class:"rounded-lg border border-gray-200 bg-gray-50 p-3"},vt={class:"font-mono text-gray-900"},ht={class:"rounded-lg border border-gray-200 bg-gray-50 p-3"},kt={class:"text-gray-900"},wt={class:"rounded-lg border border-gray-200 bg-gray-50 p-3"},$t={class:"text-gray-900"},Ct={class:"flex flex-col gap-3 sm:flex-row sm:gap-4"},_t=["disabled"],At={__name:"NewRedemptionCodeModal",props:{code:{type:Object,required:!0}},emits:["close"],setup(p,{emit:u}){const n=p,f=u,y=$(()=>typeof n.code.amount!="number"?"-":n.code.amount.toFixed(2)),x=$(()=>n.code.maxUses===0?"无限制":typeof n.code.maxUses=="number"?String(n.code.maxUses):"-"),l=$(()=>{if(!n.code.expiresAt)return"永不过期";const s=new Date(n.code.expiresAt);return Number.isNaN(s.getTime())?"-":s.toLocaleString("zh-CN")}),d=async(s,t)=>{try{await navigator.clipboard.writeText(s),h(t,"success")}catch{const b=document.createElement("textarea");b.value=s,document.body.appendChild(b),b.select();try{document.execCommand("copy"),h(t,"success")}catch{h("复制失败，请手动复制","error")}finally{document.body.removeChild(b)}}},g=async()=>{n.code.code&&await d(n.code.code,"兑换码已复制")};return(s,t)=>(m(),j(M,{to:"body"},[e("div",nt,[e("div",dt,[e("div",it,[t[3]||(t[3]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-ticket-alt text-lg text-white"})]),e("div",null,[e("h3",{class:"text-xl font-bold text-gray-900"},"兑换码创建成功"),e("p",{class:"text-sm text-gray-600"},"请及时复制并保存")])],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",title:"Close",onClick:t[0]||(t[0]=w=>f("close"))},t[2]||(t[2]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",ut,[e("div",null,[t[4]||(t[4]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"名称",-1)),e("div",ct,[e("span",xt,i(p.code.name||"-"),1)])]),e("div",null,[t[6]||(t[6]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"兑换码号",-1)),e("div",gt,[e("div",mt,i(p.code.code||"-"),1),e("div",yt,[e("button",{class:"btn-icon-sm bg-gray-700 hover:bg-gray-800",disabled:!p.code.code,title:"Copy code",type:"button",onClick:g},t[5]||(t[5]=[e("i",{class:"fas fa-copy text-gray-300"},null,-1)]),8,bt)])])]),e("div",ft,[e("div",null,[t[7]||(t[7]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"额度",-1)),e("div",pt,[e("span",vt,"$"+i(y.value),1)])]),e("div",null,[t[8]||(t[8]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"最大使用次数",-1)),e("div",ht,[e("span",kt,i(x.value),1)])])]),e("div",null,[t[9]||(t[9]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700"},"过期时间",-1)),e("div",wt,[e("span",$t,i(l.value),1)])])]),e("div",Ct,[e("button",{class:"flex w-full items-center justify-center gap-2 rounded-xl border border-blue-200 bg-blue-50 px-5 py-3 text-sm font-semibold text-blue-700 transition-colors hover:border-blue-300 hover:bg-blue-100 sm:flex-1 sm:text-base",disabled:!p.code.code,type:"button",onClick:g},t[10]||(t[10]=[e("i",{class:"fas fa-copy"},null,-1),N(" 复制兑换码 ",-1)]),8,_t),e("button",{class:"flex w-full items-center justify-center gap-2 rounded-xl border border-gray-300 bg-gray-200 px-5 py-3 text-sm font-semibold text-gray-800 transition-colors hover:border-gray-400 hover:bg-gray-300 sm:flex-1 sm:text-base",type:"button",onClick:t[1]||(t[1]=w=>f("close"))},t[11]||(t[11]=[e("i",{class:"fas fa-check-circle"},null,-1),N(" 我已保存 ",-1)]))])])])]))}},jt=Q(At,[["__scopeId","data-v-b5dea700"]]),Ut={class:"min-h-screen bg-gray-50 p-6 dark:bg-gray-900"},St={class:"mb-6 flex items-center justify-between"},Nt={class:"mb-4 rounded-xl bg-white p-4 shadow dark:bg-gray-800"},Rt={class:"flex min-w-[220px] flex-1 flex-col"},Dt=["disabled"],Tt=["disabled"],Mt={key:0,class:"flex items-center justify-center py-20"},Vt={key:1,class:"rounded-xl bg-white p-12 text-center shadow dark:bg-gray-800"},Et={class:"mb-2 text-lg font-medium text-gray-900 dark:text-white"},Bt={class:"mb-4 text-gray-500 dark:text-gray-400"},zt={key:2,class:"rounded-xl bg-white shadow dark:bg-gray-800"},It={class:"overflow-x-auto"},Lt={class:"w-full"},Ft={class:"divide-y divide-gray-200 dark:divide-gray-700"},Pt={class:"px-6 py-4"},qt={class:"font-medium text-gray-900 dark:text-white"},Ot={class:"px-6 py-4"},Kt={class:"flex items-center gap-2"},Wt={class:"font-mono text-sm text-gray-700 dark:text-gray-300"},Qt=["disabled","onClick"],Yt={class:"px-6 py-4"},Gt={class:"font-mono text-green-600 dark:text-green-400"},Ht={class:"px-6 py-4"},Jt={class:"text-gray-700 dark:text-gray-300"},Xt={class:"px-6 py-4"},Zt={class:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400"},es={class:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400"},ts={class:"px-6 py-4 text-right"},ss={class:"flex items-center justify-end gap-2"},rs=["onClick"],os=["title","onClick"],as=["onClick"],cs={__name:"RedemptionCodesView",setup(p){const u=F(),n=$(()=>u.loading),f=$(()=>u.codes),y=v(!1),x=v(!1),l=v(!1),d=v(null),g=v(!1),s=v([]),t=v(!1),w=v(null),b=v(""),r=$(()=>b.value.trim().length>0),C=o=>o?new Date(o).toLocaleString("zh-CN"):"-",U=o=>o.isActive?o.expiresAt&&new Date(o.expiresAt)<new Date?"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400":o.maxUses>0&&o.usedCount>=o.maxUses?"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400",V=o=>o.isActive?o.expiresAt&&new Date(o.expiresAt)<new Date?"已过期":o.maxUses>0&&o.usedCount>=o.maxUses?"已用完":"可用":"已禁用",E=o=>{d.value=o,x.value=!0},Y=async o=>{try{await u.updateCode(o.id,{isActive:!o.isActive}),h(o.isActive?"已禁用":"已启用","success")}catch(a){h("操作失败: "+a.message,"error")}},G=o=>{d.value=o,l.value=!0},H=async(o,a)=>{try{await navigator.clipboard.writeText(o),h(a,"success")}catch{const S=document.createElement("textarea");S.value=o,document.body.appendChild(S),S.select();try{document.execCommand("copy"),h(a,"success")}catch{h("复制失败，请手动复制","error")}finally{document.body.removeChild(S)}}},J=async o=>{o&&await H(o,"兑换码已复制")},X=async()=>{try{await u.deleteCode(d.value.id),h("删除成功","success")}catch(o){h("删除失败: "+o.message,"error")}finally{l.value=!1,d.value=null}},Z=o=>{Array.isArray(o)||(w.value=o,t.value=!0)},ee=o=>{!Array.isArray(o)||o.length===0||(s.value=o,g.value=!0)},te=async()=>{const o=b.value.trim();try{await u.fetchCodes(o?{code:o}:{})}catch(a){h("查询失败: "+a.message,"error")}},P=async()=>{b.value="";try{await u.fetchCodes()}catch(o){h("查询失败: "+o.message,"error")}};return O(()=>{u.fetchCodes()}),(o,a)=>{var B,S,z;return m(),k("div",Ut,[e("div",St,[a[8]||(a[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"兑换码管理"),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," 创建和管理兑换码，用户可通过兑换码增加 API Key 额度 ")],-1)),e("button",{class:"flex items-center gap-2 rounded-lg bg-blue-500 px-4 py-2 text-white hover:bg-blue-600",onClick:a[0]||(a[0]=c=>y.value=!0)},a[7]||(a[7]=[e("i",{class:"fas fa-plus"},null,-1),N(" 创建兑换码 ",-1)]))]),e("div",Nt,[e("form",{class:"flex flex-wrap items-end gap-3",onSubmit:T(te,["prevent"])},[e("div",Rt,[a[9]||(a[9]=e("label",{class:"mb-1 text-sm font-medium text-gray-700 dark:text-gray-300"}," 兑换码号（精确匹配） ",-1)),_(e("input",{"onUpdate:modelValue":a[1]||(a[1]=c=>b.value=c),class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"输入兑换码号",type:"text"},null,512),[[D,b.value]])]),e("button",{class:"rounded-lg bg-blue-500 px-4 py-2 text-sm font-medium text-white hover:bg-blue-600 disabled:cursor-not-allowed disabled:opacity-50",disabled:n.value,type:"submit"}," 查询 ",8,Dt),e("button",{class:"rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",disabled:n.value||!b.value,type:"button",onClick:P}," 重置 ",8,Tt)],32)]),n.value?(m(),k("div",Mt,a[10]||(a[10]=[e("i",{class:"fas fa-spinner fa-spin text-3xl text-blue-500"},null,-1)]))):f.value.length===0?(m(),k("div",Vt,[a[11]||(a[11]=e("i",{class:"fas fa-ticket-alt mb-4 text-5xl text-gray-300 dark:text-gray-600"},null,-1)),e("h3",Et,i(r.value?"未找到匹配兑换码":"暂无兑换码"),1),e("p",Bt,i(r.value?"请检查兑换码号是否正确":"点击上方按钮创建第一个兑换码"),1),r.value?(m(),k("button",{key:0,class:"rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",type:"button",onClick:P}," 清除筛选 ")):A("",!0)])):(m(),k("div",zt,[e("div",It,[e("table",Lt,[a[15]||(a[15]=e("thead",{class:"border-b border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-700/50"},[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," 名称 "),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," 兑换码号 "),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," 额度 "),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," 使用情况 "),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," 状态 "),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," 过期时间 "),e("th",{class:"px-6 py-4 text-left text-sm font-medium text-gray-600 dark:text-gray-300"}," 创建时间 "),e("th",{class:"px-6 py-4 text-right text-sm font-medium text-gray-600 dark:text-gray-300"}," 操作 ")])],-1)),e("tbody",Ft,[(m(!0),k(K,null,W(f.value,c=>(m(),k("tr",{key:c.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/30"},[e("td",Pt,[e("span",qt,i(c.name),1)]),e("td",Ot,[e("div",Kt,[e("span",Wt,i(c.code||"-"),1),e("button",{class:"rounded p-1 text-gray-400 hover:bg-gray-100 hover:text-blue-500 disabled:cursor-not-allowed disabled:opacity-50 dark:hover:bg-gray-700",disabled:!c.code,title:"Copy code",onClick:I=>J(c.code)},a[12]||(a[12]=[e("i",{class:"fas fa-copy"},null,-1)]),8,Qt)])]),e("td",Yt,[e("span",Gt," $"+i(c.amount.toFixed(2)),1)]),e("td",Ht,[e("span",Jt,i(c.usedCount)+" / "+i(c.maxUses===0?"∞":c.maxUses),1)]),e("td",Xt,[e("span",{class:L(["inline-flex rounded-full px-2 py-1 text-xs font-medium",U(c)])},i(V(c)),3)]),e("td",Zt,i(c.expiresAt?C(c.expiresAt):"永不过期"),1),e("td",es,i(C(c.createdAt)),1),e("td",ts,[e("div",ss,[e("button",{class:"rounded p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-500 dark:hover:bg-gray-700",title:"查看记录",onClick:I=>E(c)},a[13]||(a[13]=[e("i",{class:"fas fa-history"},null,-1)]),8,rs),e("button",{class:"rounded p-2 text-gray-400 hover:bg-gray-100 hover:text-yellow-500 dark:hover:bg-gray-700",title:c.isActive?"禁用":"启用",onClick:I=>Y(c)},[e("i",{class:L(c.isActive?"fas fa-pause":"fas fa-play")},null,2)],8,os),e("button",{class:"rounded p-2 text-gray-400 hover:bg-gray-100 hover:text-red-500 dark:hover:bg-gray-700",title:"删除",onClick:I=>G(c)},a[14]||(a[14]=[e("i",{class:"fas fa-trash"},null,-1)]),8,as)])])]))),128))])])])])),y.value?(m(),j(ke,{key:3,onBatchSuccess:ee,onClose:a[2]||(a[2]=c=>y.value=!1),onCreated:Z})):A("",!0),x.value?(m(),j(Me,{key:4,"code-id":(B=d.value)==null?void 0:B.id,"code-name":(S=d.value)==null?void 0:S.name,onClose:a[3]||(a[3]=c=>x.value=!1)},null,8,["code-id","code-name"])):A("",!0),oe(ae,{message:`确定要删除兑换码「${(z=d.value)==null?void 0:z.name}」吗？此操作不可恢复。`,show:l.value,title:"确认删除",onCancel:a[4]||(a[4]=c=>l.value=!1),onConfirm:X},null,8,["message","show"]),g.value?(m(),j(lt,{key:5,codes:s.value,onClose:a[5]||(a[5]=c=>g.value=!1)},null,8,["codes"])):A("",!0),t.value?(m(),j(jt,{key:6,code:w.value,onClose:a[6]||(a[6]=c=>t.value=!1)},null,8,["code"])):A("",!0)])}}};export{cs as default};
